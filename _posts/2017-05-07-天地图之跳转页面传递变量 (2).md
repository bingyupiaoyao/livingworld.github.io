---
layout: post
title: "天地图之跳转页面传递变量"
date: 2017-05-07
description: "天地图之跳转页面传递变量"
tag: 天地图
---   

## 今日任务
- [ ] asp:chart控件的使用。
- [ ] treeview：通过js或者asp.net读取数据库。
- [ ] 绘图控件：实时调用数据库绘图。
- [ ] 网站嵌套：aspx中除了继承模板外，还有嵌套的方法吗？

## asp:chart的使用

[](http://www.4guysfromrolla.com/articles/072209-1.aspx)

- [Chart 类](https://msdn.microsoft.com/zh-cn/library/system.web.ui.datavisualization.charting.chart(VS.100).aspx)

自定义事件，该事件处理程序添加方法定义：

```
// For ASP.NET
using System.Web.UI.DataVisualization.Charting;
this.Chart1.PostPaint += new EventHandler<ChartPaintEventArgs>(Chart1_PostPaint);
```

### 检索关键词：gradeplegtigheid asp:chart

刻度的设置方法：

```
chart1.ChartAreas["ChartArea1"].AxisX.LabelStyle.Format = "G";//小时
chart1.ChartAreas["ChartArea1"].AxisX.LabelStyle.Format = "D";//天

```

label垂直显示：

```
chart1.ChartAreas["ChartArea1"].AxisX.LabelStyle.Angle= -45;
```

给线条命名：
```
Chart1.Series[0].LegendText = "入库流量";
Chart1.Series[1].LegendText = "出库流量";
```

## 动态切换控件界面
### 检索关键词：Dynamically Change User Control in ASP.Net

iframe动态加载页面。

[Loading user controls dynamically
](http://stackoverflow.com/questions/4302130/loading-user-controls-dynamically)

[PlaceHolder Web Server Control](https://msdn.microsoft.com/en-us/library/tety77hf(v=VS.71).aspx)

### 检索关键词：What is an ASCX File?
- [What is an ASCX File?](https://www.lifewire.com/ascx-file-2619687)
- [How to: Create ASP.NET User Controls](https://msdn.microsoft.com/en-us/library/wt3k2fyw.aspx?ranMID=24542&ranEAID=TnL5HPStwNw&ranSiteID=TnL5HPStwNw-TPLrVpYM1ViSQa50MN8RIw&tduid=(36da3ce511c4be30159cbd03c8ee0b29)(256380)(2459594)(TnL5HPStwNw-TPLrVpYM1ViSQa50MN8RIw)())

### 检索关键词：ASP.NET User Controls

- A user controls differs from an ASP.NET Web page in these ways:
    + The file name extension for the user control is .ascx.
    + Instead of an @ Page directive, the user control contains an @ Control directive that defines configuration and other properties.
    + User controls cannot run as stand-alone files. Instead, you must add them to ASP.NET pages, as you would any control.
    + The user control does not have html, body, or form elements in it. These elements must be in the hosting page.
    + 

## 程序文件命名技巧：

chap1.aspx.cs文件：

```
using System;
using System.Configuration;
using System.Data;
using System.Linq;
using System.Web;
using System.Web.Security;
using System.Web.UI;
using System.Web.UI.HtmlControls;
using System.Web.UI.WebControls;
using System.Web.UI.WebControls.WebParts;
using System.Xml.Linq;
using System.Data.SqlClient;
using System.Text;
using System.Collections.Generic;
using System.Data.OleDb;

public partial class chap1 : System.Web.UI.Page
{
    SqlConnection conn;
    SqlCommand cmd;
    SqlDataAdapter sda;
    SqlDataReader datar;
    int rowCount = 0;//用来记录总记录数
    int ColumnsCount = 0;
    int rowCount2 = 0;//用来记录总记录数
    int ColumnsCount2 = 0;
    int rowCount3 = 0;//用来记录总记录数
    int ColumnsCount3 = 0;
    string STCD;
    string STNM;

    protected string PageTitle;
    protected void Page_Load(object sender, EventArgs e)
    {

        this.PageTitle = Request["STNM"]+ "水情信息查询";
        Label2.Text = Request["STNM"] + "水情信息查询";


        this.Context.Response.Charset = "UTF8";
        if (!this.IsPostBack)
        {
            //this.GridViewFill();
            this.Getdata_by_stationID();
        }
    }

    protected void Button1_Click(object sender, EventArgs e)
    {

        //this.GridViewFill();
        this.Getdata_by_stationID();
        /*
        lblinfo.Text = "";
        if (tvcourse.CheckedNodes.Count > 0)
        {
            foreach (TreeNode childNode in tvcourse.CheckedNodes)
            {
                lblinfo.Text += childNode.Text + "   ";
            }
        }*/
        /*if (RadioButton1.Checked == false)
        {
            TreeView1_BindData();
            TreeView1.ShowLines = true;//显示连接父节点与子节点间的线条
            TreeView1.ExpandDepth = 1;//控件显示时所展开的层数
        }*/

    }
    protected void RadioButton1_CheckedChanged(object sender, EventArgs e)
    {
        if (RadioButton1.Checked == true)
        {
            //如果被选中，则执行下面的内容。

            TreeView1_BindData();
            TreeView1.ShowLines = true;//显示连接父节点与子节点间的线条
            TreeView1.ExpandDepth = 1;//控件显示时所展开的层数
        }

    }
    /* protected void tvcourse_SelectedNodeChanged(object sender, EventArgs e)
     {

         string keyword = TreeView1.SelectedNode.Text;

     }*/
    //public void TreeView1_BindData()
    //{
    //    string constr = System.Configuration.ConfigurationManager.AppSettings["ConnectionString"].ToString();
    //    string constr2 = System.Configuration.ConfigurationManager.AppSettings["ConnectionString2"].ToString();
    //    string constr3 = System.Configuration.ConfigurationManager.AppSettings["ConnectionString2"].ToString();
    //    SqlConnection con = new SqlConnection(constr);
    //    SqlConnection con2 = new SqlConnection(constr2);
    //    SqlConnection con3 = new SqlConnection(constr2);

    //    DataSet ds = new DataSet();
    //    DataSet ds2 = new DataSet();
    //    DataSet ds3 = new DataSet();

    //    // string keyword = TreeView1.SelectedNode.Text;
    //    //node 1
    //    string strSql = "SELECT RVNM,STNM from ST_STBPRP_B ORDER by RVNM";
    //    SqlDataAdapter DA = new SqlDataAdapter(strSql, con);
    //    //ds.Clear();
    //    DA.Fill(ds, "ST_STBPRP_B");
    //    rowCount = ds.Tables["ST_STBPRP_B"].Rows.Count;         //取得总记录数目   
    //    ColumnsCount = ds.Tables["ST_STBPRP_B"].Columns.Count;
    //    //cmd = new SqlCommand(strSql, con);
    //    //datar = cmd.ExecuteReader();

    //    //TreeNode tree1 = new TreeNode("guangxi");
    //    //this.TreeView1.Nodes.Add(tree1);
    //    /*TreeNode _tnode, _parentNode;

    //    while (datar.Read())
    //    {
    //        _tnode = new TreeNode();
    //        _tnode.Text = datar["p_name"].ToString();
    //        _tnode.Value = "p_" + datar["p_id"].ToString();
    //        //tv_china.Nodes.Add(_tnode);

    //    }*/


    //    //node 2
    //    string strSql2 = "SELECT DISTINCT RVNM from ST_STBPRP_B ORDER BY RVNM ASC";
    //    SqlDataAdapter DA2 = new SqlDataAdapter(strSql2, con2);
    //    //ds2.Clear();
    //    DA2.Fill(ds2, "ST_STBPRP_B");
    //    rowCount2 = ds2.Tables["ST_STBPRP_B"].Rows.Count;         //取得总记录数目   
    //    ColumnsCount2 = ds2.Tables["ST_STBPRP_B"].Columns.Count;

    //    //node 3
    //    string strSql3 = "SELECT DISTINCT STNM from ST_STBPRP_B";
    //    SqlDataAdapter DA3 = new SqlDataAdapter(strSql3, con3);
    //    //ds.Clear();
    //    DA3.Fill(ds3, "ST_STBPRP_B");
    //    rowCount3 = ds3.Tables["ST_STBPRP_B"].Rows.Count;         //取得总记录数目   
    //    ColumnsCount3 = ds3.Tables["ST_STBPRP_B"].Columns.Count;
    //    TreeNode tree1 = new TreeNode("guangxi");
    //    TreeNode tree2, tree3;
    //    this.TreeView1.Nodes.Add(tree1);

    //    for (int i = 0; i < rowCount2; i++)
    //    {
    //        for (int j = 0; j < rowCount3; j++)
    //        {
    //            for (int k = 0; k < rowCount; k++)
    //            {
    //                if (ds2.Tables["ST_STBPRP_B"].Rows[i]["RVNM"].ToString() == ds.Tables["ST_STBPRP_B"].Rows[k]["RVNM"].ToString())
    //                {
    //                    tree2 = new TreeNode(ds.Tables["ST_STBPRP_B"].Rows[i]["RVNM"].ToString(), ds.Tables["ST_STBPRP_B"].Rows[i]["RVNM"].ToString());
    //                    tree1.ChildNodes.Add(tree2);
    //                    if (ds3.Tables["ST_STBPRP_B"].Rows[j]["STNM"].ToString() == ds.Tables["ST_STBPRP_B"].Rows[k]["STNM"].ToString())
    //                    {
    //                        tree3 = new TreeNode(ds.Tables["ST_STBPRP_B"].Rows[j]["STNM"].ToString(), ds.Tables["ST_STBPRP_B"].Rows[j]["STNM"].ToString());
    //                        tree2.ChildNodes.Add(tree3);
    //                    }
    //                    else
    //                    {
    //                        break;
    //                    }
    //                }
    //                else
    //                {
    //                    break;
    //                }
    //            }
    //        }
    //    }




    //    /*for(int i=0;i<rowCount;i++)
    //    {
    //        if(i==0)
    //        {
    //            tree2 = new TreeNode(ds.Tables["ST_STBPRP_B"].Rows[i]["RVNM"].ToString(), ds.Tables["ST_STBPRP_B"].Rows[i]["RVNM"].ToString());
    //            tree1.ChildNodes.Add(tree2);
    //            tree3 = new TreeNode(ds.Tables["ST_STBPRP_B"].Rows[i]["STNM"].ToString(), ds.Tables["ST_STBPRP_B"].Rows[i]["STNM"].ToString());
    //            tree2.ChildNodes.Add(tree3);
    //        }
    //        else if ((i>0)&&(ds.Tables["ST_STBPRP_B"].Rows[i]["RVNM"].ToString() == ds.Tables["ST_STBPRP_B"].Rows[i - 1]["RVNM"].ToString()))
    //        { 
    //            tree3 = new TreeNode(ds.Tables["ST_STBPRP_B"].Rows[i]["STNM"].ToString(), ds.Tables["ST_STBPRP_B"].Rows[i]["STNM"].ToString());
    //            tree2.ChildNodes.Add(tree3);
    //        }
    //        if ((i > 0) && (ds.Tables["ST_STBPRP_B"].Rows[i]["RVNM"].ToString() != ds.Tables["ST_STBPRP_B"].Rows[i - 1]["RVNM"].ToString()))
    //        {
    //            tree2 = new TreeNode(ds.Tables["ST_STBPRP_B"].Rows[i]["RVNM"].ToString(), ds.Tables["ST_STBPRP_B"].Rows[i]["RVNM"].ToString());
    //            tree1.ChildNodes.Add(tree2);
    //            tree3 = new TreeNode(ds.Tables["ST_STBPRP_B"].Rows[i]["STNM"].ToString(), ds.Tables["ST_STBPRP_B"].Rows[i]["STNM"].ToString());
    //            tree2.ChildNodes.Add(tree3);
    //        }
    //    }*




    //    /*TreeNode _tnode, _parentNode;
    //    while (datar.Read())
    //    {
    //        //ds.Relations.Add("tree1", ds.Tables["ST_STBPRP_B"].Columns["RVNM"], ds.Tables["ST_STBPRP_B"].Columns["STNM"]);
    //        _tnode = new TreeNode();
    //        _tnode.Text = datar["STNM"].ToString();
    //        _tnode.Value = datar["RVNM"].ToString();
    //        tree1.ChildNodes.Add(_tnode);
    //    }*/





    //    /*string[] arr1 = new string[rowCount];
    //    string[] arr2 = new string[rowCount];
    //    string[] arr3 = new string[rowCount];
    //    TreeNode tree2 = new TreeNode(ds.Tables["ST_STBPRP_B"].Rows[0]["RVNM"].ToString(), ds.Tables["ST_STBPRP_B"].Rows[0]["RVNM"].ToString());
    //    TreeNode tree3 = new TreeNode(ds.Tables["ST_STBPRP_B"].Rows[0]["STNM"].ToString(), ds.Tables["ST_STBPRP_B"].Rows[0]["STNM"].ToString());
    //    */







    //    /*
    //    for (int i=0;i<= rowCount;i++)
    //    {
    //        if (i == 0)
    //        {
    //            tree1.ChildNodes.Add(tree2);
    //            arr1[i] = ds.Tables["ST_STBPRP_B"].Rows[i]["RVNM"].ToString();
    //            tree2.ChildNodes.Add(tree3);
    //            arr2[i] = ds.Tables["ST_STBPRP_B"].Rows[i]["STNM"].ToString();
    //        }
    //        else
    //        {
    //            string s1 = ds.Tables["ST_STBPRP_B"].Rows[i]["RVNM"].ToString();
    //            for(int k=0;k< rowCount;k++)
    //            { 
    //                if(s1== arr1[k])
    //                {
    //                    tree1.ChildNodes.Add(tree2);
    //                    break;
    //                }
    //                else if(k==rowCount-1)
    //                {
    //                    tree1.ChildNodes.Add(tree2);
    //                }
    //            }

    //            TreeNode tree3 = new TreeNode(ds.Tables["ST_STBPRP_B"].Rows[i]["RVNM"].ToString(), ds.Tables["ST_STBPRP_B"].Rows[i]["RVNM"].ToString());
    //            tree2.ChildNodes.Add(tree3);
    //            TreeNode tree4 = new TreeNode(ds.Tables["ST_STBPRP_B"].Rows[i]["STNM"].ToString(), ds.Tables["ST_STBPRP_B"].Rows[i]["STNM"].ToString());
    //            tree3.ChildNodes.Add(tree4);
    //        }
    //    }

    //    */

    //    /*string s = ds.Tables["ST_STBPRP_B"].Rows[0]["BSNM"].ToString();
    //    for (int i = 0; i < rowCount2; i++)
    //    {

    //        string s2 = ds2.Tables["ST_STBPRP_B"].Rows[i]["BSNM"].ToString();
    //        string s3 = ds2.Tables["ST_STBPRP_B"].Rows[i]["RVNM"].ToString();
    //        if (s == s2)
    //        {
    //            TreeNode tree3 = new TreeNode(ds2.Tables["ST_STBPRP_B"].Rows[i]["RVNM"].ToString(), ds2.Tables["ST_STBPRP_B"].Rows[i]["RVNM"].ToString());
    //            TreeNode tree4 = new TreeNode(ds2.Tables["ST_STBPRP_B"].Rows[i]["STNM"].ToString(), ds2.Tables["ST_STBPRP_B"].Rows[i]["STNM"].ToString());
    //            for (int j = 0; j < rowCount3; j++)
    //            {
    //                TreeNode tree31 = new TreeNode(ds3.Tables["ST_STBPRP_B"].Rows[j]["RVNM"].ToString(), ds3.Tables["ST_STBPRP_B"].Rows[j]["RVNM"].ToString());
    //                string s31 = ds3.Tables["ST_STBPRP_B"].Rows[j]["RVNM"].ToString();
    //                if (s3 == s31)
    //                {
    //                    tree2.ChildNodes.Add(tree31);
    //                    tree3.ChildNodes.Add(tree4);

    //                }
    //            }

    //        }
    //    }*/



    //    /*TreeNode tree3 = new TreeNode(ds.Tables["ST_STBPRP_B"].Rows[i]["HNNM"].ToString(), ds.Tables["ST_STBPRP_B"].Rows[i]["HNNM"].ToString());
    //    tree2.ChildNodes.Add(tree3);
    //    TreeNode tree4 = new TreeNode(ds.Tables["ST_STBPRP_B"].Rows[i]["RVNM"].ToString(), ds.Tables["ST_STBPRP_B"].Rows[i]["RVNM"].ToString());
    //    tree3.ChildNodes.Add(tree4);
    //    TreeNode tree5 = new TreeNode(ds.Tables["ST_STBPRP_B"].Rows[i]["STNM"].ToString(), ds.Tables["ST_STBPRP_B"].Rows[i]["STNM"].ToString());
    //    tree4.ChildNodes.Add(tree5);
    //    */

    //    /*else
    //    {

    //        TreeNode tree2 = new TreeNode(ds.Tables["ST_STBPRP_B"].Rows[i]["BSNM"].ToString(), ds.Tables["ST_STBPRP_B"].Rows[i]["BSNM"].ToString());
    //        string s = Convert.ToString(tree2);
    //        for (int k = 0; k < arr[i].Count();k++)
    //        {
    //            if (s == arr[i])
    //            {
    //                tree1.ChildNodes.Add(tree2);
    //                arr[i] = Convert.ToString(tree2);
    //                TreeNode tree3 = new TreeNode(ds.Tables["ST_STBPRP_B"].Rows[i]["HNNM"].ToString(), ds.Tables["ST_STBPRP_B"].Rows[i]["HNNM"].ToString());
    //                tree2.ChildNodes.Add(tree3);
    //                TreeNode tree4 = new TreeNode(ds.Tables["ST_STBPRP_B"].Rows[i]["RVNM"].ToString(), ds.Tables["ST_STBPRP_B"].Rows[i]["RVNM"].ToString());
    //                tree3.ChildNodes.Add(tree4);
    //                TreeNode tree5 = new TreeNode(ds.Tables["ST_STBPRP_B"].Rows[i]["STNM"].ToString(), ds.Tables["ST_STBPRP_B"].Rows[i]["STNM"].ToString());
    //                tree4.ChildNodes.Add(tree5);
    //            }
    //        }
    //    }*/


    //    /*
    //    string[] arr = new string[20]; 
    //    arr[0] = ds.Tables["ST_STBPRP_B"].Rows[0][0].ToString();

    //    Dictionary<string, int> dictionary = new Dictionary<string, int>();
    //    dictionary.Add("apple", 1);
    //    dictionary.Add("windows", 5);
    //    if (dictionary.ContainsKey("apple"))
    //    {
    //        int value = dictionary["apple"];
    //        Console.WriteLine(value);
    //    }
    //    // See whether it contains this string.
    //    if (!dictionary.ContainsKey("acorn"))
    //    {
    //        Console.WriteLine(false);
    //    }
    //    */

    //    /*for (int i = 0; i< rowCount; i++)
    //    {
    //        if (i == 0)
    //        {
    //            TreeNode tree1 = new TreeNode(ds.Tables["ST_STBPRP_B"].Rows[i]["BSNM"].ToString(), ds.Tables["ST_STBPRP_B"].Rows[i]["BSNM"].ToString());
    //            this.TreeView1.Nodes.Add(tree1);
    //            TreeNode tree2 = new TreeNode(ds.Tables["ST_STBPRP_B"].Rows[i]["HNNM"].ToString(), ds.Tables["ST_STBPRP_B"].Rows[i]["HNNM"].ToString());
    //            tree1.ChildNodes.Add(tree2);
    //            TreeNode tree3 = new TreeNode(ds.Tables["ST_STBPRP_B"].Rows[i]["RVNM"].ToString(), ds.Tables["ST_STBPRP_B"].Rows[i]["RVNM"].ToString());
    //            tree2.ChildNodes.Add(tree3);
    //            TreeNode tree4 = new TreeNode(ds.Tables["ST_STBPRP_B"].Rows[i]["STNM"].ToString(), ds.Tables["ST_STBPRP_B"].Rows[i]["STNM"].ToString());
    //            tree3.ChildNodes.Add(tree4);
    //        }
    //        else
    //        {
    //            TreeNode tree1 = new TreeNode(ds.Tables["ST_STBPRP_B"].Rows[i]["BSNM"].ToString(), ds.Tables["ST_STBPRP_B"].Rows[i]["BSNM"].ToString());
    //            for (int k = 0; k < TreeView1.Nodes.Count; k++)
    //            {
    //                if (tree1 == TreeView1.Nodes.)
    //                {

    //                    TreeNode tree2 = new TreeNode(ds.Tables["ST_STBPRP_B"].Rows[i]["HNNM"].ToString(), ds.Tables["ST_STBPRP_B"].Rows[i]["HNNM"].ToString());
    //                    foreach (TreeNode childnode in tree1.ChildNodes)
    //                    {
    //                        if (tree2 == childnode)
    //                        {
    //                            TreeNode tree3 = new TreeNode(ds.Tables["ST_STBPRP_B"].Rows[i]["RVNM"].ToString(), ds.Tables["ST_STBPRP_B"].Rows[i]["RVNM"].ToString());
    //                            foreach (TreeNode childnode1 in tree2.ChildNodes)
    //                            {
    //                                if (tree3 == childnode1)
    //                                {
    //                                    TreeNode tree4 = new TreeNode(ds.Tables["ST_STBPRP_B"].Rows[i]["STNM"].ToString(), ds.Tables["ST_STBPRP_B"].Rows[i]["STNM"].ToString());
    //                                    tree3.ChildNodes.Add(tree4);
    //                                }
    //                                else
    //                                {
    //                                    tree2.ChildNodes.Add(tree3);
    //                                    TreeNode tree4 = new TreeNode(ds.Tables["ST_STBPRP_B"].Rows[i]["STNM"].ToString(), ds.Tables["ST_STBPRP_B"].Rows[i]["STNM"].ToString());
    //                                    tree3.ChildNodes.Add(tree4);
    //                                }
    //                            }
    //                        }
    //                        else
    //                        {
    //                            tree1.ChildNodes.Add(tree2);
    //                            TreeNode tree3 = new TreeNode(ds.Tables["ST_STBPRP_B"].Rows[i]["RVNM"].ToString(), ds.Tables["ST_STBPRP_B"].Rows[i]["RVNM"].ToString());
    //                            tree2.ChildNodes.Add(tree3);
    //                            TreeNode tree4 = new TreeNode(ds.Tables["ST_STBPRP_B"].Rows[i]["STNM"].ToString(), ds.Tables["ST_STBPRP_B"].Rows[i]["STNM"].ToString());
    //                            tree3.ChildNodes.Add(tree4);
    //                        }
    //                    }
    //                }
    //                else
    //                {
    //                    this.TreeView1.Nodes.Add(tree1);
    //                    TreeNode tree2 = new TreeNode(ds.Tables["ST_STBPRP_B"].Rows[i]["HNNM"].ToString(), ds.Tables["ST_STBPRP_B"].Rows[i]["HNNM"].ToString());
    //                    tree1.ChildNodes.Add(tree2);
    //                    TreeNode tree3 = new TreeNode(ds.Tables["ST_STBPRP_B"].Rows[i]["RVNM"].ToString(), ds.Tables["ST_STBPRP_B"].Rows[i]["RVNM"].ToString());
    //                    tree2.ChildNodes.Add(tree3);
    //                    TreeNode tree4 = new TreeNode(ds.Tables["ST_STBPRP_B"].Rows[i]["STNM"].ToString(), ds.Tables["ST_STBPRP_B"].Rows[i]["STNM"].ToString());
    //                    tree3.ChildNodes.Add(tree4);


    //                    //tree1.ChildNodes.Add(tree2);
    //                }
    //            }
    //        }
    //    }*/


    //    /*for (int k = 1; k <= rowCount; k++)
    //    {
    //        TreeNode tree2 = new TreeNode(ds.Tables["ST_STBPRP_B"].Rows[k][0].ToString(), ds.Tables["ST_STBPRP_B"].Rows[k][0].ToString());
    //        List<string> nodeList = new List<string>();
    //        foreach (TreeNode node in TreeView1.Nodes)
    //        {
    //            if (nodeList.Contains(node.Text))
    //            {
    //                tree1.ChildNodes.Add(tree2);
    //            }
    //            else
    //            {
    //                nodeList.Add(node.Text);
    //            }
    //        }

    //        for (int i = 1; i < rowCount; i++)
    //        {
    //            TreeNode tree3 = new TreeNode(ds.Tables["ST_STBPRP_B"].Rows[i][1].ToString(), ds.Tables["ST_STBPRP_B"].Rows[i][1].ToString());
    //            tree2.ChildNodes.Add(tree3);
    //            for (int j = 1; j < ColumnsCount; j++)
    //            {
    //                TreeNode tree4 = new TreeNode(ds.Tables["ST_STBPRP_B"].Rows[i][j].ToString(), ds.Tables["ST_STBPRP_B"].Rows[i][j].ToString());
    //                tree3.ChildNodes.Add(tree4);
    //            }
    //        }
    //    }*/
    //}

    protected void NavigateToPage(object sender, CommandEventArgs e)
    {
        switch (e.CommandArgument.ToString())//控制转页
        {
            case "First"://首页
                this.GridView1.PageIndex = 0;
                break;
            case "Prev"://上一页
                if (this.GridView1.PageIndex > 0)
                    this.GridView1.PageIndex -= 1;
                break;
            case "Next"://下一页
                if (this.GridView1.PageIndex < (this.GridView1.PageCount - 1))
                    this.GridView1.PageIndex += 1;
                break;
            case "Last"://尾页
                this.GridView1.PageIndex = this.GridView1.PageCount - 1;
                break;
        }
        //GridViewFill();
        Getdata_by_stationID();


    }
    private void GridViewFill()
    {
        string constr = System.Configuration.ConfigurationManager.AppSettings["ConnectionString"].ToString();
        SqlConnection con = new SqlConnection(constr);
        DataSet ds = new DataSet();

        string StartDate = this.DateTextBox1.Text.Trim();
        //  + Convert.ToString("8:00:00");
        string EndDate = this.DateTextBox2.Text.Trim();
        string strSql = "SELECT a.[STNM] as 站名,a.[ATCUNIT] 隶属行业单位,a.[STLC] as 站址,b.[TM] as 时间,b.[INQ] as 入库流量,b.[OTQ] as 出库流量,b.[RZ] as 库水位 "
            + "FROM [ST_RSVR_R] as b INNER JOIN [ST_STBPRP_B] as a ON b.[STCD] = a.[STCD] WHERE b.[TM] BETWEEN '"
            + StartDate + "' AND '" + EndDate + "'ORDER BY b.[STCD] ASC,b.[TM] ASC";

        //string strSql = "SELECT  [STCD] as 站名 , [INQ] as 入库流量, [W] as 蓄水量, [TM] as 时间, [RZ] 库水位, [OTQ] as 出库流量 FROM [ST_RSVR_R] WHERE CONVERT(varchar(10),[TM],111)=(select CONVERT(varchar(10), max([ST_RSVR_R].[TM]), 111) from [ST_RSVR_R]) ORDER BY [STCD] ASC,[TM] ASC; ";


        SqlDataAdapter DA = new SqlDataAdapter(strSql, con);
        DA.Fill(ds, "[ST_RSVR_R]");
        rowCount = ds.Tables["[ST_RSVR_R]"].Rows.Count;         //取得总记录数目   
        this.GridView1.DataSource = ds.Tables["[ST_RSVR_R]"];
        this.GridView1.DataBind();
    }
    protected void GridView_DataBind(object sender, EventArgs e)
    {
        try
        {
            GridViewRow pagerRow = GridView1.BottomPagerRow;
            //获取Label实例，显示页次信息
            Label lblCurrent = (Label)pagerRow.Cells[0].FindControl("lblPageCurrent");
            Label lblCount = (Label)pagerRow.Cells[0].FindControl("lblPageCount");
            Label lblRow = (Label)pagerRow.Cells[0].FindControl("lblPageRow");
            //获取按钮实例，为了控制其是否可用
            LinkButton btnFirstTem = (LinkButton)pagerRow.Cells[0].FindControl("btnFirst");
            LinkButton btnPrevTem = (LinkButton)pagerRow.Cells[0].FindControl("btnPrev");
            LinkButton btnNextTem = (LinkButton)pagerRow.Cells[0].FindControl("btnNext");
            LinkButton btnLastTem = (LinkButton)pagerRow.Cells[0].FindControl("btnLast");
            if (lblCurrent != null)
                lblCurrent.Text = (this.GridView1.PageIndex + 1).ToString();
            if (lblCount != null)
                lblCount.Text = this.GridView1.PageCount.ToString();
            if (lblRow != null)
                lblRow.Text = rowCount.ToString();
            if (this.GridView1.PageIndex == 0)
            {
                btnFirstTem.Enabled = false;
                btnPrevTem.Enabled = false;
                //只有一页，所有分页按钮不可用
                if (this.GridView1.PageCount == 1)
                {
                    btnNextTem.Enabled = false;
                    btnLastTem.Enabled = false;
                }
            }
            else if (this.GridView1.PageIndex == (this.GridView1.PageCount - 1))
            {
                btnNextTem.Enabled = false;
                btnLastTem.Enabled = false;
            }
        }
        catch (Exception exception)
        {
            Response.Write("<script>alert('"+ exception + "');</script>");
        }
    }
    //string text = TreeView11.SelectedNode.Text;
    protected void Getdata_by_stationID()
    {
        STCD = Request["STCD"];
        string constr = System.Configuration.ConfigurationManager.AppSettings["ConnectionString"].ToString();
        SqlConnection con = new SqlConnection(constr);
        DataSet ds = new DataSet();

        string StartDate = this.DateTextBox1.Text.Trim();
        //  + Convert.ToString("8:00:00");
        string EndDate = this.DateTextBox2.Text.Trim();
        string strSql = "SELECT a.[STNM] as 站名,a.[ATCUNIT] 隶属行业单位,a.[STLC] as 站址,b.[TM] as 时间,b.[INQ] as 入库流量,b.[OTQ] as 出库流量,b.[RZ] as 库水位 "
           + "FROM [ST_RSVR_R] as b INNER JOIN [ST_STBPRP_B] as a ON b.[STCD] = a.[STCD] WHERE b.[TM] BETWEEN '"
           + StartDate + "' AND '" + EndDate + "' AND a.[STCD] ='" + STCD + "' ORDER BY b.[STCD] ASC,b.[TM] ASC";
        //string strSql = "SELECT  [STCD] as 站名 , [INQ] as 入库流量, [W] as 蓄水量, [TM] as 时间, [RZ] 库水位, [OTQ] as 出库流量 FROM [ST_RSVR_R] WHERE CONVERT(varchar(10),[TM],111)=(select CONVERT(varchar(10), max([ST_RSVR_R].[TM]), 111) from [ST_RSVR_R]) ORDER BY [STCD] ASC,[TM] ASC; ";


        SqlDataAdapter DA = new SqlDataAdapter(strSql, con);
        DA.Fill(ds, "[ST_RSVR_R]");
        rowCount = ds.Tables["[ST_RSVR_R]"].Rows.Count;         //取得总记录数目   
        this.GridView1.DataSource = ds.Tables["[ST_RSVR_R]"];
        this.GridView1.DataBind();

        DataTable dt = new DataTable();
        DA.Fill(dt);
        con.Close();


        //设置x轴时间刻度
        Chart1.ChartAreas["ChartArea1"].AxisX.LabelStyle.Format = "G";
        Chart1.ChartAreas["ChartArea1"].AxisX.LabelStyle.Angle = -90;
       // Chart1.Series["Series1"].Legend = "入库流量";
        Chart1.DataSource = dt;
        //Give two columns of data to Y-axle
        Chart1.Series[0].YValueMembers = "入库流量";
        Chart1.Series[1].YValueMembers = "出库流量";

        Chart1.Series[0].LegendText = "入库流量";
        Chart1.Series[1].LegendText = "出库流量";
        //Set the X-axle as date value
        Chart1.Series[0].XValueMember = "时间";
        Chart1.Series[1].XValueMember = "时间";

        //Bind the Chart control with the setting above
        Chart1.DataBind();

    }

}
```


### 检索关键词：ascx and aspx exchange

