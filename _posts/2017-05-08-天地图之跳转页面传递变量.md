---
layout: post
title: "天地图之跳转页面传递变量"
date: 2017-05-08
description: "天地图之跳转页面传递变量"
tag: 天地图
---   

## 今日任务
- [x] ascx与aspx的交互。
- [x] 控件切换
- [ ] treeview：通过js或者asp.net读取数据库。
- [x] 新建窗口打开窗体，主界面不被关闭。
- [ ] treeview：实现复选框勾选，选择整个node下的childnode。
- [ ] treeview：选择value值，作为输入，查询展示列表。

## ascx与aspx的交互

搞定，注意多定义public变量，这样就能保证aspx之间的交互。

##　控件窗体切换

### 检索关键词：Show/Hide a User Control 

[using javscript](https://forums.asp.net/t/1819321.aspx?Show+Hide+a+User+Control)

[usercontrol：hiden/show](http://stackoverflow.com/questions/12228388/how-to-hide-some-controls-in-the-usercontrol-conditionally-from-parent-page)

暂时先用两个button控件来实现该功能：

```
protected void Button2_Click(object sender, EventArgs e)
    {
        //RR_INQ_table uc1 = new RR_INQ_table();
        RR_INQ_table.Visible = false;

        RR_INQ_chart.Visible = true;

    }

    protected void Button3_Click(object sender, EventArgs e)
    {
        RR_INQ_chart.Visible = false;

        RR_INQ_table.Visible = true;
    }
```

##　新建窗口打开窗体
```
    window.open("url")
```

类似的，可以打开自定义窗口：

```
window.open("https://www.w3schools.com", "_blank", "toolbar=yes,scrollbars=yes,resizable=yes,top=500,left=500,width=400,height=400");
```

- [Window open() Method](https://www.w3schools.com/jsref/met_win_open.asp)

### asp:radiobutton 无法取消选中

复选框可以实现选或者不选，但针对asp:radiobutton，可以选择另一个。

## treeview
- 没有站码信息，无法采用` newNode.Value = row["ADDVCD"].ToString();`及`DataSet ResultSet = RunQuery("Select STNM From ST_STBPRP_B Where ADDVCD=" + node.Value);`的方式判断，如果有键值，意味着可以无需重复添加。

思考：可以将sql数据转换成JSON数据，进而加载到asp:treeview上

[Ajax.NET Professional](http://www.ajaxpro.info/)
[](https://www.sencha.com/forum/showthread.php?5277-Build-JSON-Data-for-tree-from-SQL-Server-with-ASP-NET)

###　treeview加载过慢的问题

调整用户控件的可见性，可很好的提高加载速度。
```
    TreeViewUserControl.Visible = false;
```

### treeview全部选中

- [TreeView Check Uncheck all CheckBoxes ( CheckBox ) using JavaScript and jQuery in ASP.Net](https://www.aspsnippets.com/Articles/TreeView-Check-Uncheck-all-CheckBoxes-CheckBox-using-JavaScript-and-jQuery-in-ASPNet.aspx)


刚才倒是无意中撞见了一种方法：

只是该方法针对有父节点的代码比较有效，可以思考下，没有父节点，如何合理使用呢？
