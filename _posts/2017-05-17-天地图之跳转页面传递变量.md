---
layout: post
title: "asp:treeview之数据调用"
date: 2017-05-17
description: "asp:treeview之数据调用"
tag: asp.net
---   

## 今日任务
- [ ] 站点下的站名标签。
- [ ] 思考为什么会将覆盖原图层。
- [ ] 右键菜单?自定义太麻烦了。
- [ ] 思考覆盖右键事件，替代为本人想要的。
- [ ] 

## 移除marker的方式
- 移除要素
    + markLayer.removeFeatures([pointFeature]);#pointFeature可以添加到数组中。
    + markLayer.removeAllFeatures();
- 移除图层：
    + map.removeLayer(markLayer);

- [google map v3 使用自定义Marker在地图上添加文字标签 ](http://919555185.iteye.com/blog/1503287)
```
<%@ Page Language="C#"  MasterPageFile="~/scheduling.master" AutoEventWireup="true" CodeFile="TianMainPage.aspx.cs" Inherits="TianMainPage" %>
<asp:Content ID="Content1" ContentPlaceHolderID="ContentPlaceHolder1" Runat="Server">
    <!DOCTYPE html>

<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <script type="text/javascript" src="http://www.mapgx.com/ime-gx/js/geowaySDK/geoway.all.min.js"></script>
    <script type="text/javascript" src="Script/libs/jquery-1.11.2.min.js"></script>
    <title></title>
    <style type="text/css">
    body{
        font-size: 12px;
    }
    .popup_top{
        margin: 0 auto;
        width: 100%;
        border-bottom: 1px solid #ccc;
        height: 28px;
        line-height: 28px;
        background:#edf4fa;
    }
    .popup_top span{
        padding: 0 10px;
    }
    .popup_item{
        line-height: 22px;
        margin-left: 8px;
    }
    .popup_content a{
        margin-top: 10px;
        text-decoration: underline;
        margin-left: 12px;
        cursor: pointer;
        color: #336699;
    }
</style>
    <style type="text/css">
        #mapDiv {
            height: 600px;
            margin: 10px;
            border: 1px solid #ccc;
        }

        .opt_station_hover {
            background: rgb(77,103,130);
            font-size: 12px;
            width: 200px;
            height: 80px;
            border-radius: 5px;
        }

        .opt_station_hover_ul {
            list-style: none;
            margin: 0;
            padding: 0;
            line-height: 23px;
            text-indent: 4px;
            color: white;
            position: relative;
        }

            .opt_station_hover_ul li {
                list-style: none;
                margin: 0;
                padding: 0;
                overflow: hidden;
                height: 23px;
            }

        .opt_station_hover img {
            position: absolute;
            left: 50%;
            margin-left: -5px;
            margin-top: 11px;
            width: 10px;
            height: 10px;
        }

        .opt_li_left {
            width: 35px;
            display: block;
            float: left;
            text-align: right;
            margin-left: 10px;
        }
    </style>
</head>

<%--<body>--%>
<%--    <form id="form1" runat="server" style="width: 100%; height: 100%">--%>
        <div style="float: left; height: 100%; width: 16%;">
            <%--      <input id="array_store" type="hidden" name="ArrayStore" value='<%=this.ArrayStore%>'/>--%>
            <%--   <span id="array_disp"></span>--%>
            <asp:Label ID="Label1" runat="server" Text="天地图站点分布" BorderStyle="Double" Height="38px" Width="156px" Style="text-align: center;"></asp:Label>
            <ul style="height: 510px; width: 100%; margin-left: 0px; float: right;">
                <li style="height: 21px; overflow: hidden;">测站类型选择：</li>
                <%--<li style="overflow: hidden;">
                    <asp:CheckBox ID="CheckBox1" runat="server" AutoPostBack="True" OnCheckedChanged="CheckBox1_CheckedChanged" BackColor="White" Font-Size="Medium" Text="雨量站" /></li>
                <li style="overflow: hidden;">
                    <asp:CheckBox ID="CheckBox2" runat="server" AutoPostBack="True" OnCheckedChanged="CheckBox1_CheckedChanged" BackColor="White" Font-Size="Medium" Text="水库水文站" />
                </li>--%>
                <li style="overflow: hidden;">
                    <input id="checkbox1" type="checkbox" name="station" value="PP" />&nbsp;雨量站
                </li>
                <li style="overflow: hidden;">
                    <input id="checkbox2" type="checkbox" name="station" value="RR" />&nbsp;水库水文站
                </li>
                <%--    <li style="overflow: hidden;">
                <input id="checkbox3" type="checkbox" name="station" value="R" />&nbsp;水库
                 </li>--%>
                <%-- <li><asp:CheckBox ID="CheckBox3" runat="server" AutoPostBack="True" OnCheckedChanged="CheckBox1_CheckedChanged" BackColor="White" Font-Size="Medium" Text="雨量站" /> </li>
              <li><asp:CheckBox ID="CheckBox4" runat="server" AutoPostBack="True" OnCheckedChanged="CheckBox1_CheckedChanged" BackColor="White" Font-Size="Medium" Text="河道水文站" /> </li>--%>
            </ul>
            <%--<asp:Button ID="Button1" runat="server" Text="Button" OnClick="btnCallJavaScript_Click" />--%>
        </div>
        <div id="mapDiv" style="float: left;width: 80%;height:700px">
            <div id="tip" style="position:absolute;right:5px; bottom: 2px;z-index:99999; float:right;font-size:13px;"></div>
        </div>
        <script type="text/javascript">
            //var path = "/ime-gx";
            var map,markLayer_R,markLayer_P;
            var features_R = [];
            var features_p = [];
            //var pointFeature_R,pointFeature_P;
            var menu;
            var txtMenuItem
            var menuItem1 = [];
            //var lnglats;//点数据。
            var customerWinInfo;//鼠标移动上去显示的信息窗口
            var markers = [];
            var _CloudCollection;
            
            var menu;

            function loadData() {
                //$.ajaxSettings.async = false;
                // //$.getJSON('chap3.aspx', '', function (json, textStatus) {
                // //    lnglats = json;
                
                //});
                document.getElementById("checkbox1").onclick = function () {
                   
                    var items = document.getElementsByName("station");
                    if (items[0].checked ==true)
                    {
                        var lnglats = <%=ConvertDataTabletoString()%>;
                        
                        markLayer_P = new Geoway.Layer.Vector("vector_ly2");
                        map.addLayer(markLayer_P);
                        drawTMakers_P(lnglats,markLayer_P);//绘制标注。
                        selectControl(markLayer_P);

                        //map.events.register("click",this, function(evt){
                        //    selectControl2(markLayer_P);
                        //});

                        //addTEvent(markers, lnglats);//给标注添加事件。
                        //loadText(lnglats);//给标注添加名字
                    }
                    else
                    {
                        //markLayer_P.removeAllFeatures();
                        //markLayer_P.removeAllFeatures();
                        markLayer_P.removeFeatures(features_P);
                        //map.removeLayer(markLayer_P);
                        //map.removeLayer(markLayer_R);
                    }
                                            
<%--                    var lnglats = <%=ConvertDataTabletoString()%>;
                        var pointGeometry = new Geoway.Geometry.Point(lnglats[i].LGTD, lnglats[i].LTTD);
                        pointFeature_R = new Geoway.Feature.Vector(pointGeometry,{},pointStyle);
                        for (var i = 0; i < lnglats.length; i = i + 1) {
                            markLayer_P.removeFeatures([pointFeature_P]);
                        }--%>
                }
                document.getElementById("checkbox2").onclick = function () {
                    var items = document.getElementsByName("station");
                    if (items[1].checked ==true)
                    {
                        var lnglats = <%=ConvertDataTabletoString2()%>;
                        //loadText(lnglats);
                        markLayer_R = new Geoway.Layer.Vector("vector_ly");
                        map.addLayer(markLayer_R);
                        drawTMakers_R(lnglats);//绘制标注。
                        selectControl2(markLayer_R);
                        //label_R(lnglats);
                        

                        //addTEvent(markers, lnglats);//给标注添加事件。
                        //loadText(lnglats);//给标注添加名字
                        //map.events.register("click",this, function(evt){
                        //    selectControl2(markLayer_R);
                        //});


                    }
                    else
                    {
                        //map.removeLayer(markLayer_R);
                        //map.removeLayer(markLayer_P);
                        //markLayer_R.removeAllFeatures();

                        markLayer_R.removeFeatures(features_R);

                        //map.removeLayer(markLayer_R);
                        <%--var lnglats = <%=ConvertDataTabletoString2()%>;
                        var pointGeometry = new Geoway.Geometry.Point(lnglats[i].LGTD, lnglats[i].LTTD);
                        for (var i = 0; i < lnglats.length; i = i + 1) {
                            markLayer_R.removeFeatures([pointFeature_R]);//为什么针对某个marker，不能单独移除该marker点的要素呢？
                        }--%>
                    }
                }
                //$.ajaxSettings.async = true;
            }

            //加载基本地图和导航
            function loadMap() {
                try {
                    Geoway.ProxyHost = "/ime-gx/js/geowaySDK/proxy.jsp?";
                    map = new Geoway.GwMap("mapDiv"); //初始化地图对象
                    
                    //加入底图
                    Geoway.WMTSUtil.addLayerToMap("baseLayer", "http://www.mapgx.com/ime-server/rest/tdtgx_vec/wmts", true, "tiles", "Vector", map);
                    //加入标注图层
                    Geoway.WMTSUtil.addLayerToMap("labelLayer", "http://www.mapgx.com/ime-server/rest/tdtgx_vecanno/wmts", true, "tiles", "Vector", map);

                    map.setCenter(new Geoway.LonLat(108.05163, 24.696892), 8);//设置显示地图的中心点和级别

                    //markLayer_R = new Geoway.Layer.Vector("vector_ly2");
                    //markLayer_P = new Geoway.Layer.Vector("vector_ly");
                    //map.addLayer(markLayer_R);
                    //map.addLayer(markLayer_P);

                    label = new Geoway.Layer.Vector("vector_label");
                    
                    //markLayer_P = new Geoway.Layer.Vector("vector_ly");
                    ////map.addLayers([markLayer_P,markLayer_R]);
                    //map.addLayer(markLayer_P);
                    map.events.register("mousemove",this, function(evt){
                        var x = evt.x ? evt.x : evt.pageX;
                        var y = evt.y ? evt.y : evt.pageY;
                        var pixel = new Geoway.Pixel(x,y);
                        var lonlat = map.getLonLatFromPixel(pixel);
                        document.getElementById("tip").innerHTML = " 经度：" +lonlat.lon.toFixed(3) + " 纬度：" + lonlat.lat.toFixed(3) + " 层级："+ map.getZoom() ;
                    });
        
                    map.events.register("click",this, function(evt){
                        var pixel = new Geoway.Pixel(evt.x,evt.y);
                        var lonlat = map.getLonLatFromPixel(pixel);
                        var zoom = map.getZoom();
                        map.panToView(lonlat);
                        map.zoomTo(zoom);
                    });
                }
               catch (err) {
                    alert('天地图加载不成功，请稍候再试！你可以先使用其他功能！');
                }
            }
            //function loadmarker_R(){
            //    markLayer_R = new Geoway.Layer.Vector("vector_ly2");
            //    map.addLayer(markLayer_R);
            //}
            //function loadmarker_P(){
            //    markLayer_P = new Geoway.Layer.Vector("vector_ly");
            //    map.addLayer(markLayer_P);
            //}


            function selectControl(markLayers){
                selectControl = new Geoway.Control.SelectFeature(markLayers,{
                    onSelect: onSelect, 
                    onUnselect: onUnselect
                })
                map.addControl(selectControl);
                selectControl.activate();
            }
            function selectControl2(markLayers){
                selectControl2 = new Geoway.Control.SelectFeature(markLayers,{
                    onSelect: onSelect2, 
                    onUnselect: onUnselect2
                })
                map.addControl(selectControl2);
                selectControl2.activate();
            }
            function onSelect(feature){
                for(var i = map.popups.length - 1; i >= 0; --i){
                    var popupTemp = map.popups[i];
                    if(popupTemp){
                        map.removePopup(map.popups[i]);
                    }
                }
                selectControl.unselectAll();
                showPopup(feature);
            }

            function onSelect2(feature){
                for(var i=map.popups.length - 1; i >= 0; --i){
                    var popupTemp = map.popups[i];
                    if(popupTemp){
                        map.removePopup(map.popups[i]);
                    }
                }
                selectControl2.unselectAll();
                showPopup2(feature);
            }
           
            function showPopup(feature){
                var stationType;
                if(feature.attributes.STTP=="RR"){
                    stationType ='水库水文站'}
                if(feature.attributes.STTP=="PP"){
                    stationType ='雨量站'}
                var lonlat = feature.geometry.getBounds().getCenterLonLat();
                var size = new Geoway.Size(210, 130);
                var html = '<div class="popup_top"><span>河池市</span></div>';
                html += '<div class="popup_content">';
                html += '<div class="popup_item">坐标：'+ lonlat.lon + ','+lonlat.lat + '</div>';
                html += '<div class="popup_item">站址：'+feature.attributes.STNM+'</div>';
                html += '<div class="popup_item">站码：'+feature.attributes.STCD+'</div>';
                html += '<div class="popup_item">站类：'+stationType+'</div>';
                html += '</div>';
                var popup1 = new Geoway.GeowayPopup("mark_popup1", lonlat, size, html, 12, true);
                feature.popup = popup1;
                map.addPopup(popup1);
            }
            function showPopup2(feature){
                var stationType;
                if(feature.attributes.STTP=="RR"){
                    stationType ='水库水文站'}
                if(feature.attributes.STTP=="PP"){
                    stationType ='雨量站'}
                var lonlat = feature.geometry.getBounds().getCenterLonLat();
                var size = new Geoway.Size(210, 130);
                var html = '<div class="popup_top"><span>河池市</span></div>';
                html += '<div class="popup_content">';
                html += '<div class="popup_item">坐标：'+ lonlat.lon + ','+lonlat.lat + '</div>';
                html += '<div class="popup_item">站址：'+feature.attributes.STNM+'</div>';
                html += '<div class="popup_item">站码：'+feature.attributes.STCD+'</div>';
                html += '<div class="popup_item">站类：'+stationType+'</div>';
                html += '</div>';
                var popup2 = new Geoway.GeowayPopup("mark_popup2", lonlat, size, html, 12, true);
                feature.popup = popup2;
                map.addPopup(popup2);
            }
            

            function onUnselect(feature){
            }
            function onUnselect2(feature){
            }

            //显示弹框,自定义。
            //function showPopup(feature){
            //    var lonlat = feature.geometry.getBounds().getCenterLonLat();
            //    var size = new Geoway.Size(210, 130);
            //    var html = '<div class="popup_top"><span>河池市</span></div>';
            //    html += '<div class="popup_content">';
            //    html += '<div class="popup_item">坐标：'+ lonlat.lon + ','+lonlat.lat + '</div>';
            //    html += '<div class="popup_item">站址：'+feature.attributes.STNM+'</div>';
            //    html += '<div class="popup_item">站码：'+feature.attributes.STCD+'</div>';
            //    html += '<div class="popup_item">站类：水库水文站</div>';
            //    html += '</div>';
            //    var popup = new Geoway.GeowayPopup("mark_popup", lonlat, size, html, 12, true);
            //    feature.popup = popup;
            //    map.addPopup(popup);
            //}


            ////鼠标从图标移动出去的时候执行
            //function onClose() {
            //    clearTimeout(timer);
            //    map.removeOverLay(customerWinInfo);
            //}

            //把标注点名字画到地图上
            function loadText(lnglats) {
                var label = [];//标点名字图。
                if (lnglats.length != 0) {
                    for (var i = 0; i < lnglats.length; i = i + 1) {
                        var stationType;
                        if(lnglats[i].STTP=="RR"){
                            stationType = lnglats[i].STNM;
                        };
                        if(lnglats[i].STTP=="PP"){
                            stationType = lnglats[i].STNM;
                            }
                        var lonlat = [lnglats[i].LGTD,lnglats[i].LTTD];
                        var size = new Geoway.Size(10, 10);
                        var html = '<div class="popup_top"><span>河池市</span></div>';
                        html += '<div class="popup_item">'+stationType+'</div>';
                        html += '</div>';
                        var popup = new Geoway.GeowayPopup("mark_popup", lonlat, size, html, 12, true);
                        feature.popup = popup;
                        map.addPopup(popup);
                        //customerWinInfo.setLabel
                    }
                }
            }

            function onMouseDown(m,lnglats) {
                var html = [];
                html.push(" <div class='opt_station_hover' id='device_online'>");
                html.push("     <ul class='opt_station_hover_ul'>");
                html.push("         <li><span class='opt_li_left'>站名：</span>" + lnglats[m.id].STNM + "</li>");
                html.push("         <li><span class='opt_li_left'>站码：</span>" + lnglats[m.id].STCD + "</li>");
                html.push("         <li><span class='opt_li_left'>坐标：</span>" + lnglats[m.id].LGTD + ',' + lnglats[m.id].LTTD + "</li>");
                html.push("         <img src='Image/天地图/arrow.png'>");
                html.push("     </ul>");
                html.push(" </div>");
                var config = {
                    offset: new TPixel(5, -60),
                    position: m.getLngLat()
                };
                customerWinInfo = new TLabel(config);
                customerWinInfo.setLabel(html.join(''));
                customerWinInfo.setAnchorPer([0.5, 0.5]);//偏移量
                customerWinInfo.getObject().style.zIndex = 10000;
                map.addOverLay(customerWinInfo);
                $('.opt_station_hover').parent().css({
                    "border": "none",
                    "padding": "0",
                    "background-color": ""
                });
            }

            function drawTMakers_R(lnglats) {
                if(lnglats){
                    for (var i = 0; i < lnglats.length; i = i + 1) {
                        var pointStyle = Geoway.Util.extend({},Geoway.Feature.Vector.style["default"]);
                        pointStyle.externalGraphic =  "/images/mapapi/R.jpg";
                        pointStyle.graphicWidth = 10;
                        pointStyle.graphicHeight = 15;
                        pointStyle.graphicXOffset = -5;
                        pointStyle.graphicYOffset = -15;
                        pointStyle.graphicOpacity  = 1;
                        var pointGeometry = new Geoway.Geometry.Point(lnglats[i].LGTD, lnglats[i].LTTD);
                        var pointFeature_R = new Geoway.Feature.Vector(pointGeometry, lnglats[i],pointStyle);
                        features_R.push(pointFeature_R);
                        //markLayer_R.addFeatures([pointFeature_R]);
                        //markers[i] = markLayer_R;
                        //markers[i].id = i;
                        //var linearRing = new Geoway.Geometry.LinearRing(pointGeometry);
                        //var rectFeature = new Geoway.Feature.Vector(linearRing);
                        //var rectStyle = Geoway.Util.extend({},Geoway.Feature.Vector.style["default"]);
                    }
                    markLayer_R.addFeatures(features_R);
                    
                }
            }

            function label_R(lnglats){
                if(lnglats){
                    for (var i = 0; i < lnglats.length; i = i + 1) {
                        var pointStyle = Geoway.Util.extend({},Geoway.Feature.Vector.style["default"]);
                        //pointStyle.externalGraphic =  "/images/mapapi/R.jpg";
                        pointStyle.graphicWidth = 10;
                        pointStyle.graphicHeight = 15;
                        pointStyle.graphicXOffset = -5;
                        pointStyle.graphicYOffset = -15;
                        pointStyle.graphicOpacity  = 1;
                        var pointGeometry = new Geoway.Geometry.Point(lnglats[i].LGTD, lnglats[i].LTTD);
                        var pointFeature_R = new Geoway.Feature.Vector(pointGeometry, lnglats[i],pointStyle);
                        features_R.push(pointFeature_R);


                        var div = document.createElement('DIV'); //创建存放图片和文字的div  
                        div.style.border = "none";     
                        div.style.borderWidth = "0px";     
                        div.style.position = "absolute";  
                        div.style.cursor = "hand";  
                        div.onclick = this.clickFun ||function(){};//注册click事件，没有定义就为空函数  
                        // Create an IMG element and attach it to the DIV.    
                        //初始化文字标签  
                        var label = document.createElement('div');//创建文字标签  
                        label.className = this.labelClass;  
                        label.innerHTML = this.labelText;  
                        label.style.position = 'absolute';  
                        label.style.width = '200px';  
                        //  label.style.fontWeight = "bold";  
                        label.style.textAlign = 'left';  
                        label.style.padding = "2px";  
                        label.style.fontSize = "10px";  
                        //  label.style.fontFamily = "Courier New";  
                
                        div.appendChild(label);     
                        //this.div_ = div;     
                        // We add an overlay to a map via one of the map's panes.    
                        // We'll add this overlay to the overlayImage pane.    
                        //var panes = this.getPanes();    
                        //panes.overlayLayer.appendChild(div);  
                        markLayer_R.addControl(div);
                    }  
                }
            }


            function drawTMakers_P(lnglats,markers) {
                var features_P = [];
                for (var i = 0; i < lnglats.length; i = i + 1) {
                    var pointStyle = Geoway.Util.extend({},Geoway.Feature.Vector.style["default"]);
                    pointStyle.externalGraphic =  "/images/mapapi/PP.jpg";
                    pointStyle.graphicWidth = 10;
                    pointStyle.graphicHeight = 15;
                    pointStyle.graphicXOffset = -5;
                    pointStyle.graphicYOffset = -15;
                    pointStyle.graphicOpacity  = 1;
                    var pointGeometry = new Geoway.Geometry.Point(lnglats[i].LGTD, lnglats[i].LTTD);
                    var pointFeature_P = new Geoway.Feature.Vector(pointGeometry, lnglats[i],pointStyle);
                    features_P.push(pointFeature_P);
                    //markLayer_R.addFeatures([pointFeature_R]);
                    //markers[i] = markLayer_R;
                    //markers[i].id = i;
                }
                markers.addFeatures(features_P);
            }
            //往地图上添加一个marker。传入参数坐标信息lnglat。传入参数图标信息。
            //function drawTMaker(lnglat, icon) {
            //    //对象       //构造函数        
            //    var marker = new TMarker(new TLngLat(lnglat.LGTD, lnglat.LTTD), { icon: icon });
            //    map.addOverLay(marker);
            //    return marker;
            //}
            //function drawTMaker1(lnglat){
            //    //var pointStyle = Geoway.Util.extend({},Geoway.Feature.Vector.style["default"]);
            //    //pointStyle.externalGraphic =  "/images/mapapi/R.jpg";
            //    //pointStyle.graphicWidth = 10;
            //    //pointStyle.graphicHeight = 15;
            //    //pointStyle.graphicXOffset = -5;
            //    //pointStyle.graphicYOffset = -15;
            //    //pointStyle.graphicOpacity  = 1;
            //    //var pointGeometry = new Geoway.Geometry.Point(lnglat.LGTD, lnglat.LTTD);
            //    //var pointFeature = new Geoway.Feature.Vector(pointGeometry,{},pointStyle);
            //    //markLayer.addFeatures([pointFeature]);
            //    //return markLayer;
            //}


            function drawItem(m,lnglats) {
                var menu = new TContextMenu();
                //TPixel1 = new TPixel();
                //TPixel2 = new TPixel();
                txtMenuItem =
                [
                    {
                        text: '实时降雨过程',
                        callback: function rain() {
                            window.open("chap1.aspx");
                            //  window.location = "chap1.aspx";
                            //map.removeOverLay(menu);
                            //var lgt = lnglats[m.id].LGTD ;
                            //var ltt = lnglats[m.id].LTTD ;
                                
                        }
                    },
                    {
                        text: '实时入库流量过程',
                        callback: function  Qin() {
                            var STCD = lnglats[m.id].STCD;
                            var STNM = lnglats[m.id].STNM;
                            window.open("chap1.aspx?STCD="+STCD+"&STNM="+STNM);
                            // form.action
                            //window.location.href
                            // document.getElementById("Hidden1").value = lnglats[m.id].STCD;
                            
                                
                            //array_store = document.getElementById("array_store");
                            //array_store.value = lnglats[m.id].STCD;
                            //document.getElementById("array_disp").innerHTML = array_store.value;
                            


                            //btnCallJavaScript_Click;
                           
                        }
                    },
                        {
                            text: '获得右键点击处坐标',
                            callback: function (lnglat) {
                                alert(lnglat.getLng() + "," + lnglat.getLat());
                            }
                        },


                        //{
                        //    text: string(lnglats[m.id].STNM),
                        //    callback: function () {
                        //        //OnMouseDown(m);
                        //        window.location = "chap1.aspx";
                        //        //map.removeOverLay(menu);

                        //    }
                        ////}
                        //{
                        //    text: '调度计算',
                        //    callback: function (lonlat) {
                        //        getParam(lonlat, "e");
                        //    }
                        //},

                        //{
                        //    text: '水库特性曲线表',
                        //    callback: function (lonlat) {
                        //        getParam(lonlat, "e");
                        //    }
                        //}
                ];
                    for (var i = 0; i < txtMenuItem.length; i++) {
                        //创建右键菜单参数接口对象

                        var options = new TMenuItemOptions();
                        // var options = new TContextMenuOptions();
                        //设置右键菜单的宽度
                        options.width = 100;
                        //添加菜单项

                        menuItem1[i] = new TMenuItem(txtMenuItem[i].text,
                                txtMenuItem[i].callback, options)
                        menu.addItem(menuItem1[i]);
                        if (i == 1 || i == 3) {
                            //添加分割线
                            menu.addSeparator();
                        }
                    }
                //添加右键菜单


                //var config = {
                //    offset: new TPixel(5, -60),
                //    position: m.getLngLat()
                //};
                //customerWinInfo = new TLabel(config);
                //customerWinInfo.setLabel(menu);
                //customerWinInfo.setAnchorPer([0.5, 0.5]);//偏移量
                //customerWinInfo.getObject().style.zIndex = 10000;
                //map.addOverLay(customerWinInfo);
                //$('.opt_station_hover').parent().css({
                //    "border": "none",
                //    "padding": "0",
                //    "background-color": ""
                //});
                    map.addOverLay(menu);
                }

                //function clearItem() {
                //    TEvent.addListener(menu, "close", function () {
                //        map.removeOverLay(menu);
                //    });
                //}

            

                //加载mouseover与mouseout事件。 
                //iconMakers是已添加的标注对象。
                //lnglats是每个点的数据对象。通常iconMakers的length等于lnglats的length。
                //eventFn是传入 鼠标移动上去要调用哪个函数。默认是onMouseDown。
                function addTEvent(iconMakers, lnglats) {
                    var arrLen = lnglats.length;
                    for (var i = 0; i < arrLen; i++) {
                        iconMakers[i].id = i;
                        //绑定事件
                        (function () {
                            //m是指Object对象,not contain any value。
                            var m = iconMakers[i];

                            //注册事件程序,declare function
                            function handler(evt) {
                                    onMouseDown(m,lnglats);
                            }

                            function geowayEvent(evt) {
                                var x = evt.x ? evt.x : evt.pageX;
                                var y = evt.y ? evt.y : evt.pageY;
                                var pixel = new Geoway.Pixel(x,y);
                                var lonlat = map.getLonLatFromPixel(pixel);
                                alert("经度："+lonlat.lon.toFixed(3) + " 纬度："+lonlat.lat.toFixed(3));
                            }

                            var handler1 = function (TPixel, Number) {
                                //if (Number == 2) {
                                //    drawItem(m);
                                //}
                                var stationcate = lnglats[m.id].STTP;

                                if ((Number == 2) && (stationcate == "RR")) {
                                    drawItem(m,lnglats);

                                }
                                if ((Number == 2) && (stationcate == "PP")) {
                                    onMouseDown(m,lnglats);

                                }
                            };
                            //var removemenu1 = function (TPixel, Number) {
                            //    map.removeOverLay(menu);
                            //}
                            map.events.register("click",m, handler)
                            //map.events.unregister("click",this, onClose)

                            //TEvent.addListener(m, "mousedown", handler);
                            //TEvent.addListener(m, "mouseout", onClose);
                            ////      TEvent.addListener(map, "mousedown", onClose);
                            //TEvent.addListener(m, "mousedown", handler1);

                            //  TEvent.removeListener(map, "mousedown", removemenu);
                            //TEvent.addListener(m, "mousedown", removemenu1);
                            //  TEvent.addListener(m, "mouseout", clearItem);


                        })();
                    }
                }
                //function clearEvent()
                //{
                //    TEvent.addListener(map, "click", removemenu);
                //}
                loadMap();//加载地图
                //loadmarker_R();
                //loadmarker_P();
                loadData();//加载数据
                drawTMakers_R(lnglats);
                drawTMakers_P(lnglats);
                
                //drawTMakers(lnglats);//绘制标注。
                addTEvent(markers, lnglats);//给标注添加事件。
                //loadText();//给标注添加名字
                //clearEvent()
        </script>
<%-- </form>--%>
<%--   </body>
</html>--%>
</asp:Content>
```